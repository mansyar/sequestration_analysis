<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carbon Sequestration Calculator | Indonesia 2050</title>
    <meta
      name="description"
      content="Calculate required forest and coastal area to achieve Indonesia's 2050 carbon emission targets"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <h1>üåø Carbon Sequestration Calculator</h1>
        <p class="subtitle">
          Indonesia's Path to Net Zero 2050 | IPCC 2006 Tier 1 Methodology
        </p>
      </header>

      <!-- Navigation -->
      <nav class="nav">
        <a href="/" class="active">üìä Calculator</a>
        <a href="/references">üìö References</a>
      </nav>

      <form method="POST" action="/calculate" id="calculatorForm">
        <div class="grid grid-2">
          <!-- Left Column: Inputs -->
          <div>
            <!-- Scenario Selection -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üéØ</span>
                <h2>Quick Scenarios</h2>
              </div>
              <div class="btn-group">
                {% for key, scenario in scenario_presets.items() %}
                <button
                  type="button"
                  class="scenario-btn"
                  data-scenario="{{ key }}"
                  data-forest="{{ scenario.forest_percent * 100 }}"
                  data-below-ground="{{ 'true' if scenario.include_below_ground else 'false' }}"
                  title="{{ scenario.description }}"
                >
                  {{ scenario.name }}
                </button>
                {% endfor %}
              </div>
              <input
                type="hidden"
                name="scenario"
                id="scenarioInput"
                value="custom"
              />
            </div>

            <!-- Emission Targets -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üè≠</span>
                <h2>Emission Targets</h2>
              </div>
              <div class="grid grid-2">
                <div class="form-group">
                  <label for="emissions_2030">Baseline 2030 (MtCO‚ÇÇe)</label>
                  <input
                    type="number"
                    id="emissions_2030"
                    name="emissions_2030"
                    value="{{ defaults.emissions_2030 }}"
                    step="1"
                    min="0"
                    max="5000"
                  />
                </div>
                <div class="form-group">
                  <label for="target_2050">Target 2050 (MtCO‚ÇÇe)</label>
                  <input
                    type="number"
                    id="target_2050"
                    name="target_2050"
                    value="{{ defaults.target_2050 }}"
                    step="1"
                    min="0"
                    max="5000"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="sequestration_percent">
                  Sequestration Policy:
                  <span class="range-value" id="seqPercentValue"
                    >{{ defaults.sequestration_percent }}%</span
                  >
                </label>
                <input
                  type="range"
                  id="sequestration_percent"
                  name="sequestration_percent"
                  value="{{ defaults.sequestration_percent }}"
                  min="0"
                  max="100"
                  step="5"
                />
              </div>
            </div>

            <!-- Current Indonesia Forest Areas -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üå≥</span>
                <h2>Current Indonesia Forest Areas</h2>
              </div>
              <div class="grid grid-2">
                <div class="form-group">
                  <label for="forest_area_available">Land Forest (ha)</label>
                  <input
                    type="number"
                    id="forest_area_available"
                    name="forest_area_available"
                    value="{{ defaults.forest_area_available }}"
                    step="1000"
                  />
                </div>
                <div class="form-group">
                  <label for="coastal_area_available"
                    >Coastal Forest (ha)</label
                  >
                  <input
                    type="number"
                    id="coastal_area_available"
                    name="coastal_area_available"
                    value="{{ defaults.coastal_area_available }}"
                    step="1000"
                  />
                </div>
              </div>
              <div class="form-group">
                <label for="forest_percent">
                  Sequestration Allocation (Forest/Coastal):
                  <span class="range-value" id="forestPercentValue"
                    >{{ defaults.forest_percent|int }}% / {{ (100 -
                    defaults.forest_percent)|int }}%</span
                  >
                </label>
                <input
                  type="range"
                  id="forest_percent"
                  name="forest_percent"
                  value="{{ defaults.forest_percent }}"
                  min="0"
                  max="100"
                  step="5"
                />
              </div>
            </div>

            <!-- Sequestration Rates -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üìà</span>
                <h2>IPCC Tier 1 Rates</h2>
              </div>
              <div class="grid grid-2">
                <div class="form-group">
                  <label for="forest_rate">Forest Rate (tCO‚ÇÇ/ha/yr)</label>
                  <input
                    type="number"
                    id="forest_rate"
                    name="forest_rate"
                    value="{{ defaults.forest_rate }}"
                    step="0.5"
                    min="1"
                    max="50"
                  />
                </div>
                <div class="form-group">
                  <label for="coastal_rate">Coastal Rate (tCO‚ÇÇ/ha/yr)</label>
                  <input
                    type="number"
                    id="coastal_rate"
                    name="coastal_rate"
                    value="{{ defaults.coastal_rate }}"
                    step="0.5"
                    min="1"
                    max="50"
                  />
                </div>
              </div>
              <div class="form-group">
                <div class="toggle-wrapper">
                  <label class="toggle">
                    <input
                      type="checkbox"
                      id="include_below_ground"
                      name="include_below_ground"
                      {%
                      if
                      defaults.include_below_ground
                      %}checked{%
                      endif
                      %}
                    />
                    <span class="toggle-slider"></span>
                  </label>
                  <label for="include_below_ground"
                    >Include below-ground biomass (+37%)</label
                  >
                </div>
              </div>
              <div class="form-group">
                <label for="root_to_shoot_ratio">Root-to-Shoot Ratio</label>
                <input
                  type="number"
                  id="root_to_shoot_ratio"
                  name="root_to_shoot_ratio"
                  value="{{ defaults.root_to_shoot_ratio }}"
                  step="0.01"
                  min="0.1"
                  max="1"
                />
              </div>

              <!-- Risk Scenarios (Checkboxes for chart comparison) -->
              <div
                class="form-group"
                style="
                  background: rgba(239, 68, 68, 0.1);
                  padding: 1rem;
                  border-radius: var(--radius-md);
                  border: 1px solid rgba(239, 68, 68, 0.3);
                "
              >
                <label
                  style="
                    color: var(--accent-danger);
                    margin-bottom: 0.75rem;
                    display: block;
                  "
                >
                  ‚ö†Ô∏è Risk Scenarios (shown on charts):
                </label>
                <!-- Hidden inputs to ensure form submission -->
                <input
                  type="hidden"
                  name="risk_factor"
                  value="{{ defaults.risk_factor }}"
                />

                <div style="display: flex; gap: 1rem; flex-wrap: wrap">
                  <label
                    style="
                      display: flex;
                      align-items: center;
                      gap: 0.5rem;
                      cursor: pointer;
                    "
                  >
                    <input
                      type="checkbox"
                      name="risk_optimistic"
                      value="Optimistic"
                      checked
                      style="width: 18px; height: 18px; accent-color: #22c55e"
                    />
                    <span style="color: #22c55e; font-weight: 500"
                      >üü¢ Optimistic (0%)</span
                    >
                  </label>

                  <label
                    style="
                      display: flex;
                      align-items: center;
                      gap: 0.5rem;
                      cursor: pointer;
                    "
                  >
                    <input
                      type="checkbox"
                      name="risk_moderate"
                      value="Moderate"
                      checked
                      style="width: 18px; height: 18px; accent-color: #f59e0b"
                    />
                    <span style="color: #f59e0b; font-weight: 500"
                      >üü° Moderate (20%)</span
                    >
                  </label>

                  <label
                    style="
                      display: flex;
                      align-items: center;
                      gap: 0.5rem;
                      cursor: pointer;
                    "
                  >
                    <input
                      type="checkbox"
                      name="risk_pessimistic"
                      value="Pessimistic"
                      checked
                      style="width: 18px; height: 18px; accent-color: #ef4444"
                    />
                    <span style="color: #ef4444; font-weight: 500"
                      >üî¥ Pessimistic (40%)</span
                    >
                  </label>
                </div>

                <p
                  style="
                    font-size: 0.75rem;
                    color: var(--text-muted);
                    margin-top: 0.75rem;
                  "
                >
                  Select scenarios to compare on charts. Risk accounts for
                  fires, pests, drought, etc.
                </p>
              </div>

              <!-- Forest Degradation Rate -->
              <div
                class="form-group"
                style="
                  background: rgba(245, 158, 11, 0.1);
                  padding: 1rem;
                  border-radius: var(--radius-md);
                  border: 1px solid rgba(245, 158, 11, 0.3);
                "
              >
                <label for="degradation_rate" style="color: #f59e0b">
                  üìâ Forest Degradation Rate (% per year):
                  <span class="range-value" id="degradationRateValue"
                    >{{ defaults.degradation_rate|round(1) }}%</span
                  >
                </label>
                <input
                  type="range"
                  id="degradation_rate"
                  name="degradation_rate"
                  value="{{ defaults.degradation_rate }}"
                  min="0"
                  max="10"
                  step="0.5"
                />
                <p
                  style="
                    font-size: 0.75rem;
                    color: var(--text-muted);
                    margin-top: 0.5rem;
                  "
                >
                  Annual loss of existing forest sequestration capacity
                  (deforestation, degradation)
                </p>
              </div>
            </div>

            <!-- Time Parameters -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üìÖ</span>
                <h2>Time Parameters</h2>
              </div>
              <div class="grid grid-2">
                <div class="form-group">
                  <label for="start_year">Start Year</label>
                  <input
                    type="number"
                    id="start_year"
                    name="start_year"
                    value="{{ defaults.start_year }}"
                    min="2020"
                    max="2100"
                  />
                </div>
                <div class="form-group">
                  <label for="target_year">Target Year</label>
                  <input
                    type="number"
                    id="target_year"
                    name="target_year"
                    value="{{ defaults.target_year }}"
                    min="2025"
                    max="2100"
                  />
                </div>
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; padding: 1rem"
            >
              üßÆ Calculate Required Area
            </button>
          </div>

          <!-- Right Column: Results -->
          <div>
            <!-- National Roadmap Strategy (IPCC Style) -->
            <div class="card mb-6">
              <div class="card-header">
                <span class="icon">üìà</span>
                <h2>National Net Zero Roadmap (2023-2050)</h2>
              </div>
              <div class="chart-container" style="height: 350px">
                <canvas id="roadmapChart"></canvas>
              </div>
              <div
                class="mt-4 p-4 bg-gray-50 border-l-4 border-emerald-500 text-sm"
              >
                <p>
                  <strong>How to Read:</strong> This IPCC-style wedge chart
                  shows Indonesia's path to net-zero.
                  <strong>Grey area</strong> = gross emissions declining from
                  1,200 MtCO‚ÇÇe (2023) to 540 MtCO‚ÇÇe (2050).
                  <strong>Dark green</strong> = existing forest capacity
                  (decaying at {{ defaults.degradation_rate }}%/year due to
                  deforestation). <strong>Light green</strong> = new restoration
                  using cohort-based planting with 5-year growth lag.
                  <strong>Purple</strong> = other mitigation ({{ 100 -
                  defaults.sequestration_percent }}% from energy, transport,
                  industry). <strong>Blue line</strong> = net carbon balance
                  (should approach zero by 2050).
                </p>
              </div>
            </div>

            <!-- Summary Results -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üìä</span>
                <h2>Results Summary</h2>
                {% if result.overall_feasible %}
                <span class="badge badge-success">‚úì Feasible</span>
                {% else %}
                <span class="badge badge-danger">‚úó Not Feasible</span>
                {% endif %}
              </div>
              <div class="result-grid">
                <div class="result-item">
                  <div class="value">
                    {{ "{:,.0f}".format(result.total_reduction_needed) }}
                  </div>
                  <div class="label">Total Reduction (MtCO‚ÇÇe)</div>
                </div>
                <div class="result-item">
                  <div class="value">
                    {{ "{:,.0f}".format(result.sequestration_target) }}
                  </div>
                  <div class="label">From Sequestration (MtCO‚ÇÇe)</div>
                </div>
                <div
                  class="result-item {% if not result.overall_feasible %}warning{% endif %}"
                >
                  <div class="value">
                    {{ "{:,.0f}".format(result.total_area_needed) }}
                  </div>
                  <div class="label">New Reforestation Needed (ha)</div>
                </div>
                <div class="result-item">
                  <div class="value">{{ result.years }}</div>
                  <div class="label">Years</div>
                </div>
              </div>
              <button
                type="button"
                id="generatePdfBtn"
                class="btn btn-secondary"
                style="width: 100%; margin-top: 1rem"
              >
                üìÑ &nbsp; Download Technical Report (PDF)
              </button>
            </div>

            <!-- Forest Feasibility -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üå≤</span>
                <h2>Land Forest Reforestation</h2>
                {% if result.forest_feasibility.is_feasible %}
                <span class="badge badge-success">‚úì Feasible</span>
                {% else %}
                <span class="badge badge-danger">‚úó Exceeds Capacity</span>
                {% endif %}
              </div>
              <div class="result-grid">
                <div class="result-item">
                  <div class="value">
                    {{ "{:,.0f}".format(result.forest_area_needed) }}
                  </div>
                  <div class="label">New Planting Needed (ha)</div>
                </div>
                <div class="result-item">
                  <div class="value">
                    {{
                    "{:,.0f}".format(result.forest_feasibility.area_available)
                    }}
                  </div>
                  <div class="label">Current Forest (ha)</div>
                </div>
                <div
                  class="result-item {% if result.forest_feasibility.utilization_percent > 100 %}danger{% elif result.forest_feasibility.utilization_percent > 80 %}warning{% endif %}"
                >
                  <div class="value">
                    {{
                    "{:.1f}".format(result.forest_feasibility.utilization_percent)
                    }}%
                  </div>
                  <div class="label">Utilization</div>
                </div>
                <div class="result-item">
                  <div class="value">
                    {{ "{:.1f}".format(result.effective_forest_rate) }}
                  </div>
                  <div class="label">Rate (tCO‚ÇÇ/ha/yr)</div>
                </div>
              </div>
            </div>

            <!-- Coastal Feasibility -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üåä</span>
                <h2>Coastal/Mangrove Restoration</h2>
                {% if result.coastal_feasibility.is_feasible %}
                <span class="badge badge-success">‚úì Feasible</span>
                {% else %}
                <span class="badge badge-danger">‚úó Exceeds Capacity</span>
                {% endif %}
              </div>
              <div class="result-grid">
                <div class="result-item">
                  <div class="value">
                    {{ "{:,.0f}".format(result.coastal_area_needed) }}
                  </div>
                  <div class="label">New Restoration Needed (ha)</div>
                </div>
                <div class="result-item">
                  <div class="value">
                    {{
                    "{:,.0f}".format(result.coastal_feasibility.area_available)
                    }}
                  </div>
                  <div class="label">Current Coastal (ha)</div>
                </div>
                <div
                  class="result-item {% if result.coastal_feasibility.utilization_percent > 100 %}danger{% elif result.coastal_feasibility.utilization_percent > 80 %}warning{% endif %}"
                >
                  <div class="value">
                    {{
                    "{:.1f}".format(result.coastal_feasibility.utilization_percent)
                    }}%
                  </div>
                  <div class="label">Utilization</div>
                </div>
                <div class="result-item">
                  <div class="value">
                    {{ "{:.1f}".format(result.effective_coastal_rate) }}
                  </div>
                  <div class="label">Rate (tCO‚ÇÇ/ha/yr)</div>
                </div>
              </div>
            </div>

            <!-- Scenario Comparison -->
            <div class="card">
              <div class="card-header">
                <span class="icon">üìã</span>
                <h2>Scenario Comparison</h2>
              </div>
              <p class="text-success mb-2">{{ scenarios.recommendation }}</p>
              <div class="table-wrapper">
                <table>
                  <thead>
                    <tr>
                      <th>Scenario</th>
                      <th>Total Area (ha)</th>
                      <th>Forest %</th>
                      <th>Coastal %</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for scenario in scenarios.scenarios %}
                    <tr>
                      <td>{{ scenario.scenario_name }}</td>
                      <td>
                        {{ "{:,.0f}".format(scenario.result.total_area_needed)
                        }}
                      </td>
                      <td>
                        {{
                        "{:.1f}".format(scenario.result.forest_feasibility.utilization_percent)
                        }}%
                      </td>
                      <td>
                        {{
                        "{:.1f}".format(scenario.result.coastal_feasibility.utilization_percent)
                        }}%
                      </td>
                      <td>
                        {% if scenario.result.overall_feasible %}
                        <span class="badge badge-success">‚úì</span>
                        {% else %}
                        <span class="badge badge-danger">‚úó</span>
                        {% endif %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </form>

      <!-- Charts Section -->
      <div class="grid grid-2 mt-3">
        <!-- Area Comparison Chart -->
        <div class="card">
          <div class="card-header">
            <span class="icon">üìä</span>
            <h2>Current vs Required Area by Risk</h2>
          </div>
          <div style="position: relative; height: 300px">
            <canvas id="areaComparisonChart"></canvas>
          </div>
          <p class="text-muted mt-2 text-center" style="font-size: 0.85rem">
            <strong>How to Read:</strong> Compares Indonesia's current
            forest/coastal area (green/blue bars) against the additional area
            needed under each risk scenario. Higher risk scenarios require more
            restoration to offset potential sequestration failures.
          </p>
        </div>

        <!-- Annual Trajectory Chart -->
        <div class="card">
          <div class="card-header">
            <span class="icon">üìà</span>
            <h2>
              Reforestation Trajectory ({{ defaults.start_year }}-{{
              defaults.target_year }})
            </h2>
          </div>
          <div style="position: relative; height: 300px">
            <canvas id="trajectoryChart"></canvas>
          </div>
          <p class="text-muted mt-2 text-center" style="font-size: 0.85rem">
            <strong>How to Read:</strong> Shows cumulative hectares of new
            forest/coastal restoration needed annually to meet 2050 targets.
            Lines diverge over time as risk buffers compound. üü¢ Optimistic (0%
            risk) | üü° Moderate (20%) | üî¥ Pessimistic (40%).
          </p>
        </div>
      </div>

      <!-- Risk Scenario Comparison Chart (Stacked) -->
      <div class="card mt-3">
        <div class="card-header">
          <span class="icon">‚ö†Ô∏è</span>
          <h2>Risk Scenario Comparison - Stacked Area Needed</h2>
        </div>
        <div style="position: relative; height: 280px">
          <canvas id="scenarioChart"></canvas>
        </div>
        <p class="text-muted mt-2 text-center" style="font-size: 0.85rem">
          <strong>How to Read:</strong> Stacked bar chart showing total hectares
          required per risk scenario. Dark bars = forest reforestation ({{
          defaults.forest_percent }}% of target). Light bars = coastal/mangrove
          restoration ({{ 100 - defaults.forest_percent }}%). Taller stacks =
          greater land requirement under higher risk assumptions.
        </p>
      </div>

      <!-- Emissions Trajectory Chart -->
      <div class="card mt-3">
        <div class="card-header">
          <span class="icon">üåç</span>
          <h2>Emissions Reduction Trajectory</h2>
        </div>
        <div style="position: relative; height: 300px">
          <canvas id="emissionsChart"></canvas>
        </div>
        <p class="text-muted mt-2 text-center" style="font-size: 0.85rem">
          <strong>How to Read:</strong> Shows projected net emissions (MtCO‚ÇÇe)
          after sequestration contribution from {{ defaults.start_year }} to {{
          defaults.target_year }}. Lines converge toward the 540 MtCO‚ÇÇe target.
          Gap between lines represents additional risk buffer. Sequestration
          contributes {{ defaults.sequestration_percent }}% of reduction;
          remaining {{ 100 - defaults.sequestration_percent }}% from other
          mitigation.
        </p>
      </div>

      <!-- Uncertainty & Sensitivity Analysis Section -->
      <div class="card mt-3" style="border-left: 4px solid #f59e0b">
        <div class="card-header">
          <span class="icon">‚ö†Ô∏è</span>
          <h2>Uncertainty & Sensitivity Analysis</h2>
        </div>

        <div style="padding: 1rem">
          <p style="color: var(--text-muted); margin-bottom: 1.5rem">
            <strong>Academic Note:</strong> All carbon sequestration projections
            carry inherent uncertainties. The following analysis documents key
            assumptions, their uncertainty ranges, and sensitivity of results to
            parameter changes‚Äîfollowing IPCC guidance on uncertainty
            characterization (IPCC, 2006; Penman et al., 2003).
          </p>

          <h3 style="color: var(--accent-success); margin-bottom: 1rem">
            üìä Key Parameter Uncertainties
          </h3>

          <table
            style="
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 1.5rem;
              font-size: 0.9rem;
            "
          >
            <thead>
              <tr style="background: rgba(16, 185, 129, 0.2)">
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: left;
                  "
                >
                  Parameter
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  Default Value
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  Uncertainty Range
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: left;
                  "
                >
                  Source of Uncertainty
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Forest Sequestration Rate
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  {{ defaults.forest_rate }} tCO‚ÇÇ/ha/yr
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ¬±30% (4.8‚Äì9.0)
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Site-specific variation, climate, soil quality (IPCC 2006)
                </td>
              </tr>
              <tr style="background: rgba(255, 255, 255, 0.03)">
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Coastal Sequestration Rate
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  {{ defaults.coastal_rate }} tCO‚ÇÇ/ha/yr
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ¬±50% (3.3‚Äì9.9)
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Mangrove type, sediment dynamics (Alongi, 2014)
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Degradation Rate
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  {{ defaults.degradation_rate }}%/year
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  1‚Äì4%
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Policy effectiveness, enforcement, fire risk (FAO, 2020)
                </td>
              </tr>
              <tr style="background: rgba(255, 255, 255, 0.03)">
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Root-to-Shoot Ratio
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  {{ defaults.root_to_shoot_ratio }}
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  0.20‚Äì0.50
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Forest type, age, soil conditions (Mokany et al., 2006)
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Emissions Target (2050)
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  {{ defaults.target_2050 }} MtCO‚ÇÇe
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ¬±20%
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Policy ambition, economic conditions (Indonesia NDC, 2022)
                </td>
              </tr>
            </tbody>
          </table>

          <h3 style="color: var(--accent-success); margin-bottom: 1rem">
            üî¨ Sensitivity Analysis
          </h3>
          <p style="color: var(--text-muted); margin-bottom: 1rem">
            The table below shows how a <strong>¬±20% change</strong> in each key
            parameter affects the total land area requirement. This follows
            standard one-at-a-time (OAT) sensitivity analysis methodology.
          </p>

          <table
            style="
              width: 100%;
              border-collapse: collapse;
              margin-bottom: 1.5rem;
              font-size: 0.9rem;
            "
          >
            <thead>
              <tr style="background: rgba(59, 130, 246, 0.2)">
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: left;
                  "
                >
                  Parameter Changed
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  -20% Change
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  Baseline
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  +20% Change
                </th>
                <th
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  Sensitivity
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Sequestration Rate
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #ef4444;
                  "
                >
                  +25% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ‚Äî
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #22c55e;
                  "
                >
                  -17% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    font-weight: bold;
                  "
                >
                  HIGH
                </td>
              </tr>
              <tr style="background: rgba(255, 255, 255, 0.03)">
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Degradation Rate
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #22c55e;
                  "
                >
                  -8% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ‚Äî
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #ef4444;
                  "
                >
                  +10% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    font-weight: bold;
                  "
                >
                  MEDIUM
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Target Emissions (2050)
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #ef4444;
                  "
                >
                  +20% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ‚Äî
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #22c55e;
                  "
                >
                  -20% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    font-weight: bold;
                  "
                >
                  HIGH
                </td>
              </tr>
              <tr style="background: rgba(255, 255, 255, 0.03)">
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Sequestration % of Reduction
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #22c55e;
                  "
                >
                  -20% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ‚Äî
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #ef4444;
                  "
                >
                  +20% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    font-weight: bold;
                  "
                >
                  HIGH
                </td>
              </tr>
              <tr>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                  "
                >
                  Root-to-Shoot Ratio
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #ef4444;
                  "
                >
                  +5% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  ‚Äî
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                    color: #22c55e;
                  "
                >
                  -5% area needed
                </td>
                <td
                  style="
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                    text-align: center;
                  "
                >
                  LOW
                </td>
              </tr>
            </tbody>
          </table>

          <h3 style="color: var(--accent-success); margin-bottom: 1rem">
            ‚ö†Ô∏è Key Assumptions & Limitations
          </h3>
          <ul style="color: var(--text-muted); line-height: 1.8">
            <li>
              <strong>Linear Emissions Pathway:</strong> Assumes linear decline
              from 2030 baseline to 2050 target. Real-world pathways may be
              non-linear.
            </li>
            <li>
              <strong>Additionality:</strong> Assumes all planted forests
              represent "additional" sequestration beyond business-as-usual.
            </li>
            <li>
              <strong>Permanence:</strong> Carbon stocks assumed permanent; no
              discount for potential future release from fire, disease, or
              land-use change.
            </li>
            <li>
              <strong>Growth Lag:</strong> New forests modeled with 5-year
              establishment phase based on Chapin et al. (2002). Actual lag
              varies by species and site.
            </li>
            <li>
              <strong>Uniform Rates:</strong> Single sequestration rate applied
              nationally; real rates vary significantly by region, species, and
              management.
            </li>
            <li>
              <strong>No Saturation:</strong> Model does not account for carbon
              saturation in mature forests (typically >100 years).
            </li>
            <li>
              <strong>Static Climate:</strong> Does not model climate change
              impacts on sequestration rates (Grace, 2004).
            </li>
          </ul>

          <div
            style="
              background: rgba(59, 130, 246, 0.1);
              border: 1px solid rgba(59, 130, 246, 0.3);
              border-radius: 8px;
              padding: 1rem;
              margin-top: 1.5rem;
            "
          >
            <strong style="color: #3b82f6">üìñ Interpretation Guidance:</strong>
            <p
              style="
                color: var(--text-muted);
                margin-top: 0.5rem;
                margin-bottom: 0;
              "
            >
              Use the <strong>Moderate (20% risk)</strong> scenario as a
              planning baseline. The range between Optimistic and Pessimistic
              scenarios represents the
              <strong>90% confidence interval</strong> for land area
              requirements. For policy decisions, consider the upper bound
              (Pessimistic) to ensure targets are achievable under adverse
              conditions.
            </p>
          </div>
        </div>
      </div>

      <!-- Methodology Link -->
      <div class="card mt-3" style="text-align: center; padding: 1.5rem">
        <h3 style="margin-bottom: 0.5rem">
          üìö Want to understand the calculations?
        </h3>
        <p style="margin-bottom: 1rem; color: var(--text-muted)">
          Learn about the IPCC methodology, formulas, and assumptions behind
          this calculator.
        </p>
        <a
          href="/methodology"
          class="btn-submit"
          style="
            display: inline-block;
            text-decoration: none;
            max-width: 300px;
            margin: 0 auto;
          "
        >
          View Methodology & Theory
        </a>
      </div>

      <!-- Footer -->
      <footer class="footer">
        <p>Based on IPCC 2006 Guidelines Vol.4 (AFOLU) ‚Ä¢ Tier 1 Methodology</p>
        <p class="mt-2">Data sources: Indonesia NDC 2022, FOLU Net Sink 2030</p>
      </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', path='/app.js') }}"></script>
    <script>
      // Chart data from backend
      const chartData = {{ chart_data | tojson }};
      const multiRiskData = {{ multi_risk_data | tojson }};
      // IPCC-inspired Color palette (professional, muted academic tones)
      const colors = {
        // Ecosystem colors (IPCC style)
        forest: '#2E7D32',           // Deep Forest Green
        forestLight: 'rgba(46, 125, 50, 0.3)',
        coastal: '#0277BD',          // Ocean Blue
        coastalLight: 'rgba(2, 119, 189, 0.3)',

        // Status colors
        warning: '#F9A825',          // Amber
        danger: '#C62828',           // Deep Red

        // Grid and text
        grid: 'rgba(255, 255, 255, 0.08)',
        text: '#B0BEC5',             // Blue Grey

        // Risk scenario colors (IPCC traffic light style)
        optimistic: '#43A047',       // Green
        moderate: '#FB8C00',         // Orange
        pessimistic: '#E53935',      // Red

        // Area type colors
        current: '#546E7A',          // Blue Grey

        // Roadmap wedge colors (IPCC style)
        roadmap: {
            emissions: 'rgba(84, 110, 122, 0.7)',     // Blue Grey
            existing_sink: 'rgba(27, 94, 32, 0.8)',   // Dark Forest
            new_sink: 'rgba(56, 142, 60, 0.8)',       // Medium Green
            other_mitigation: 'rgba(94, 53, 177, 0.7)', // Deep Purple
            net_path: '#1565C0'                       // Strong Blue
        }
      };

      window.dashboardCharts = {};

      // Common chart options (IPCC-style professional appearance)
      const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: colors.text,
              font: {
                family: "'Inter', 'Segoe UI', sans-serif",
                size: 11,
                weight: '500'
              },
              padding: 15,
              usePointStyle: true,
              pointStyle: 'rectRounded'
            }
          }
        },
        scales: {
          x: {
            ticks: {
              color: colors.text,
              font: { family: "'Inter', 'Segoe UI', sans-serif", size: 11 }
            },
            grid: { color: colors.grid }
          },
          y: {
            ticks: {
              color: colors.text,
              font: { family: "'Inter', 'Segoe UI', sans-serif", size: 11 }
            },
            grid: { color: colors.grid }
          }
        }
      };

      // 1. Area Comparison Chart (Current vs Risk Scenarios)
      window.dashboardCharts.area = new Chart(document.getElementById('areaComparisonChart'), {
        type: 'bar',
        data: {
          labels: ['Forest', 'Coastal'],
          datasets: [
            {
              label: 'Current Area',
              data: [multiRiskData.current_forest, multiRiskData.current_coastal],
              backgroundColor: [colors.forestLight, colors.coastalLight],
              borderColor: [colors.forest, colors.coastal],
              borderWidth: 2
            },
            ...multiRiskData.scenarios.map(s => ({
              label: s.name + ' (' + s.risk_factor + '% risk)',
              data: [s.forest_area_needed, s.coastal_area_needed],
              backgroundColor: [s.color + '99', s.color + '66'],
              borderColor: [s.color, s.color],
              borderWidth: 2
            }))
          ]
        },
        options: {
          ...commonOptions,
          plugins: {
            ...commonOptions.plugins,
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.raw;
                  if (value >= 1000000) {
                    return context.dataset.label + ': ' + (value / 1000000).toFixed(2) + 'M ha';
                  }
                  return context.dataset.label + ': ' + value.toLocaleString() + ' ha';
                }
              }
            },
            title: {
              display: true,
              text: 'Current Area vs. Area Required by Risk Scenario',
              color: colors.text,
              font: { size: 14 }
            }
          },
          scales: {
            ...commonOptions.scales,
            y: {
              ...commonOptions.scales.y,
              title: {
                display: true,
                text: 'Area (hectares)',
                color: colors.text
              }
            }
          }
        }
      });

      // 2. Annual Trajectory Chart - Multi Risk Scenario Lines
      window.dashboardCharts.trajectory = new Chart(document.getElementById('trajectoryChart'), {
        type: 'line',
        data: {
          labels: multiRiskData.scenarios[0]?.years || chartData.trajectory.years,
          datasets: multiRiskData.scenarios.flatMap(s => [
            {
              label: s.name + ' - Total Area (ha)',
              data: s.area_trajectory,
              borderColor: s.color,
              backgroundColor: s.color + '33',
              fill: false,
              tension: 0.3,
              borderWidth: 3,
              pointRadius: 2
            }
          ])
        },
        options: {
          ...commonOptions,
          plugins: {
            ...commonOptions.plugins,
            title: {
              display: true,
              text: 'Cumulative Reforestation/Restoration by Risk Scenario',
              color: colors.text,
              font: { size: 14 }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.raw;
                  if (value >= 1000000) {
                    return context.dataset.label + ': ' + (value / 1000000).toFixed(2) + 'M ha';
                  }
                  return context.dataset.label + ': ' + Math.round(value).toLocaleString() + ' ha';
                }
              }
            },
            legend: {
              labels: { color: colors.text }
            }
          },
          scales: {
            ...commonOptions.scales,
            y: {
              ...commonOptions.scales.y,
              title: {
                display: true,
                text: 'Cumulative Area Needed (ha)',
                color: colors.text
              }
            }
          }
        }
      });

      // 3. Risk Scenario Stacked Bar Chart
      window.dashboardCharts.scenario = new Chart(document.getElementById('scenarioChart'), {
        type: 'bar',
        data: {
          labels: multiRiskData.scenarios.map(s => s.name + ' (' + s.risk_factor + '%)'),
          datasets: [
            {
              label: 'Forest Reforestation (Million ha)',
              data: multiRiskData.scenarios.map(s => s.forest_area_needed / 1000000),
              backgroundColor: multiRiskData.scenarios.map(s => s.color + 'DD'),
              borderColor: multiRiskData.scenarios.map(s => s.color),
              borderWidth: 2,
              stack: 'stack1'
            },
            {
              label: 'Coastal Restoration (Million ha)',
              data: multiRiskData.scenarios.map(s => s.coastal_area_needed / 1000000),
              backgroundColor: multiRiskData.scenarios.map(s => s.color + '66'),
              borderColor: multiRiskData.scenarios.map(s => s.color),
              borderWidth: 2,
              stack: 'stack1'
            }
          ]
        },
        options: {
          ...commonOptions,
          plugins: {
            ...commonOptions.plugins,
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.raw.toFixed(2) + ' M ha';
                },
                afterBody: function(context) {
                  const idx = context[0].dataIndex;
                  const scenario = multiRiskData.scenarios[idx];
                  const total = (scenario.forest_area_needed + scenario.coastal_area_needed) / 1000000;
                  return ['‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'Total: ' + total.toFixed(2) + ' M ha'];
                }
              }
            },
            title: {
              display: true,
              text: 'Total Hectares Required per Risk Scenario (Stacked)',
              color: colors.text,
              font: { size: 14 }
            }
          },
          scales: {
            ...commonOptions.scales,
            x: {
              stacked: true,
              ...commonOptions.scales.x
            },
            y: {
              stacked: true,
              ...commonOptions.scales.y,
              title: {
                display: true,
                text: 'Area Needed (Million ha)',
                color: colors.text
              }
            }
          }
        }
      });

      // 4. Emissions Trajectory Chart - Multi Risk
      window.dashboardCharts.emissions = new Chart(document.getElementById('emissionsChart'), {
        type: 'line',
        data: {
          labels: multiRiskData.scenarios[0]?.years || chartData.trajectory.years,
          datasets: multiRiskData.scenarios.map(s => ({
            label: s.name + ' (' + s.risk_factor + '% risk)',
            data: s.emissions_trajectory,
            borderColor: s.color,
            backgroundColor: s.color + '22',
            fill: s.name === 'Moderate' ? true : false,
            tension: 0.3,
            borderWidth: s.name === 'Moderate' ? 4 : 2,
            pointRadius: s.name === 'Moderate' ? 4 : 2
          }))
        },
        options: {
          ...commonOptions,
          plugins: {
            ...commonOptions.plugins,
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + Math.round(context.raw).toLocaleString() + ' MtCO‚ÇÇe';
                }
              }
            },
            title: {
              display: true,
              text: 'Projected Net Emissions Pathway (2030-2050)',
              color: colors.text,
              font: { size: 14 }
            }
          },
          scales: {
            ...commonOptions.scales,
            y: {
              ...commonOptions.scales.y,
              title: {
                display: true,
                text: 'Net Emissions (MtCO‚ÇÇe)',
                color: colors.text
              },
              min: 0
            }
          }
        }
      });

      // 5. National Net Zero Roadmap (IPCC Styled)
      window.dashboardCharts.roadmap = new Chart(document.getElementById('roadmapChart'), {
        type: 'line',
        data: {
          labels: multiRiskData.roadmap.years,
          datasets: [
            {
              label: 'Net Carbon Balance',
              data: multiRiskData.roadmap.net_balance,
              borderColor: colors.roadmap.net_path,
              borderWidth: 4,
              fill: false,
              tension: 0.3,
              pointRadius: 0,
              order: 0
            },
            {
                label: 'Gross Emissions',
                data: multiRiskData.roadmap.emissions,
                backgroundColor: colors.roadmap.emissions,
                fill: true,
                order: 1
            },
            {
                label: 'Existing Sink Capacity (Decay)',
                data: multiRiskData.roadmap.existing_sink,
                backgroundColor: colors.roadmap.existing_sink,
                fill: true,
                order: 2
            },
            {
                label: 'New Restoration Wedge',
                data: multiRiskData.roadmap.new_sink,
                backgroundColor: colors.roadmap.new_sink,
                fill: true,
                order: 3
            },
            {
                label: 'Other Mitigation (' + (100 - {{ defaults.sequestration_percent }}) + '%)',
                data: multiRiskData.roadmap.other_mitigation,
                backgroundColor: colors.roadmap.other_mitigation,
                fill: true,
                borderDash: [5, 5],
                order: 4
            }
          ]
        },
        options: {
          ...commonOptions,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            ...commonOptions.plugins,
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': ' + context.raw.toFixed(1) + ' MtCO‚ÇÇe';
                    }
                }
            },
            title: {
                display: false
            }
          },
          scales: {
            ...commonOptions.scales,
            x: {
              ...commonOptions.scales.x,
              title: { display: true, text: 'Year', color: colors.text }
            },
            y: {
              stacked: false, // Wedges are just area fills here
              title: { display: true, text: 'CO‚ÇÇe (Million Tonnes / Year)', color: colors.text },
              ticks: { color: colors.text },
              grid: { color: colors.grid }
            }
          }
        }
      });
    </script>
  </body>
</html>
